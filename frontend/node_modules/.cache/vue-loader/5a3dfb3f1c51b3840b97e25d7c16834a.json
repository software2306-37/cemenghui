{"remainingRequest":"E:\\Idea works\\GithubUploadFild\\cemenghui\\frontend\\cemenghui\\frontend\\node_modules\\vue-loader-v16\\dist\\index.js??ref--1-1!E:\\Idea works\\GithubUploadFild\\cemenghui\\frontend\\cemenghui\\frontend\\src\\views\\UserManage.vue?vue&type=style&index=0&id=041d5aca&scoped=true&lang=css","dependencies":[{"path":"E:\\Idea works\\GithubUploadFild\\cemenghui\\frontend\\cemenghui\\frontend\\src\\views\\UserManage.vue","mtime":1752137225630},{"path":"E:\\Idea works\\GithubUploadFild\\cemenghui\\frontend\\cemenghui\\frontend\\node_modules\\css-loader\\dist\\cjs.js","mtime":1752137215822},{"path":"E:\\Idea works\\GithubUploadFild\\cemenghui\\frontend\\cemenghui\\frontend\\node_modules\\vue-loader-v16\\dist\\stylePostLoader.js","mtime":1752137225080},{"path":"E:\\Idea works\\GithubUploadFild\\cemenghui\\frontend\\cemenghui\\frontend\\node_modules\\postcss-loader\\src\\index.js","mtime":1752137223127},{"path":"E:\\Idea works\\GithubUploadFild\\cemenghui\\frontend\\cemenghui\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1752137215170},{"path":"E:\\Idea works\\GithubUploadFild\\cemenghui\\frontend\\cemenghui\\frontend\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":1752137225072}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQouY2FyZC1oZWFkZXIgew0KICBkaXNwbGF5OiBmbGV4Ow0KICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47DQogIGFsaWduLWl0ZW1zOiBjZW50ZXI7DQp9DQoNCi5zZWFyY2gtYmFyIHsNCiAgbWFyZ2luLWJvdHRvbTogMjBweDsNCn0NCg0KLnBhZ2luYXRpb24gew0KICBtYXJnaW4tdG9wOiAyMHB4Ow0KICB0ZXh0LWFsaWduOiByaWdodDsNCn0NCg0KLnZpZXctaXRlbSB7DQogIG1hcmdpbi1ib3R0b206IDE1cHg7DQogIGxpbmUtaGVpZ2h0OiAxLjY7DQp9DQoNCi5lbXB0eS1kYXRhIHsNCiAgcGFkZGluZzogNDBweCAwOw0KfQ0K"},{"version":3,"sources":["E:\\Idea works\\GithubUploadFild\\cemenghui\\frontend\\cemenghui\\frontend\\src\\views\\UserManage.vue"],"names":[],"mappings":";AA4YA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE;EACX,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;EACb,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;EAC9B,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;AACrB;;AAEA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE;EACV,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;AACrB;;AAEA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE;EACV,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;EAChB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC;AACnB;;AAEA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE;EACT,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;EACnB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC;AAClB;;AAEA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE;EACV,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC;AACjB","file":"E:/Idea works/GithubUploadFild/cemenghui/frontend/cemenghui/frontend/src/views/UserManage.vue","sourceRoot":"","sourcesContent":["<template>\r\n  <div class=\"user-manage\">\r\n    <el-card>\r\n      <template #header>\r\n        <div class=\"card-header\">\r\n          <span>用户管理</span>\r\n          <div>\r\n            <el-button type=\"info\" @click=\"loadUsers\" :loading=\"loading\">\r\n              <el-icon><Refresh /></el-icon>\r\n              刷新\r\n            </el-button>\r\n            <el-button type=\"danger\" @click=\"batchDelete\" :disabled=\"selectedUsers.length === 0\">批量删除</el-button>\r\n            <el-button type=\"success\" @click=\"exportUsers\">导出用户</el-button>\r\n            <el-button type=\"primary\" @click=\"showAddDialog = true\">新增用户</el-button>\r\n          </div>\r\n        </div>\r\n      </template>\r\n\r\n      <!-- 搜索栏 -->\r\n      <div class=\"search-bar\">\r\n        <el-row :gutter=\"20\">\r\n          <el-col :span=\"4\">\r\n            <el-input\r\n              v-model=\"searchKeyword\"\r\n              placeholder=\"请输入用户名、昵称、手机号或邮箱\"\r\n              clearable\r\n              @keyup.enter=\"loadUsers\"\r\n            />\r\n          </el-col>\r\n          <el-col :span=\"4\">\r\n            <el-select v-model=\"roleFilter\" placeholder=\"角色筛选\" clearable>\r\n              <el-option label=\"全部\" value=\"\" />\r\n              <el-option label=\"管理员\" value=\"ADMIN\" />\r\n              <el-option label=\"企业用户\" value=\"USER\" />\r\n            </el-select>\r\n          </el-col>\r\n          <el-col :span=\"4\">\r\n            <el-select v-model=\"statusFilter\" placeholder=\"状态筛选\" clearable>\r\n              <el-option label=\"全部\" value=\"\" />\r\n              <el-option label=\"启用\" :value=\"1\" />\r\n              <el-option label=\"禁用\" :value=\"0\" />\r\n            </el-select>\r\n          </el-col>\r\n          <el-col :span=\"6\">\r\n            <el-date-picker\r\n              v-model=\"dateRange\"\r\n              type=\"daterange\"\r\n              range-separator=\"至\"\r\n              start-placeholder=\"开始日期\"\r\n              end-placeholder=\"结束日期\"\r\n              @change=\"loadUsers\"\r\n            />\r\n          </el-col>\r\n          <el-col :span=\"4\" style=\"margin-left: 40px\">\r\n            <el-button type=\"primary\" @click=\"loadUsers\">搜索</el-button>\r\n            <el-button @click=\"resetSearch\">重置</el-button>\r\n          </el-col>\r\n        </el-row>\r\n      </div>\r\n\r\n      <!-- 用户表格 -->\r\n      <el-table :data=\"users\" style=\"width: 100%\" v-loading=\"loading\" @selection-change=\"handleSelectionChange\">\r\n        <template #empty>\r\n          <div class=\"empty-data\">\r\n            <el-empty description=\"暂无用户数据\" />\r\n          </div>\r\n        </template>\r\n        <el-table-column type=\"selection\" width=\"55\" />\r\n        <el-table-column label=\"头像\" width=\"80\">\r\n          <template #default=\"scope\">\r\n            <el-avatar :size=\"40\" :src=\"getImageUrl(scope.row.avatar)\">\r\n              {{ scope.row.nickname || scope.row.username }}\r\n            </el-avatar>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"username\" label=\"用户名\" width=\"120\" />\r\n        <el-table-column prop=\"nickname\" label=\"昵称\" width=\"120\" />\r\n        <el-table-column prop=\"phone\" label=\"手机号\" width=\"130\" />\r\n        <el-table-column prop=\"email\" label=\"邮箱\" width=\"180\" />\r\n        <el-table-column prop=\"companyName\" label=\"企业名称\" width=\"150\" />\r\n        <el-table-column prop=\"role\" label=\"角色\" width=\"100\">\r\n          <template #default=\"scope\">\r\n            <el-tag :type=\"scope.row.role === 'ADMIN' ? 'danger' : 'primary'\">\r\n              {{ scope.row.role === 'ADMIN' ? '管理员' : '企业用户' }}\r\n            </el-tag>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"status\" label=\"状态\" width=\"100\">\r\n          <template #default=\"scope\">\r\n            <el-tag :type=\"scope.row.status === 1 ? 'success' : 'danger'\">\r\n              {{ scope.row.status === 1 ? '启用' : '禁用' }}\r\n            </el-tag>\r\n          </template>\r\n        </el-table-column>\r\n        <el-table-column prop=\"createTime\" label=\"创建时间\" width=\"180\" />\r\n        <el-table-column label=\"操作\" width=\"250\">\r\n          <template #default=\"scope\">\r\n            <el-button size=\"small\" @click=\"viewUser(scope.row)\">查看</el-button>\r\n            <el-button size=\"small\" @click=\"editUser(scope.row)\">编辑</el-button>\r\n            <el-button size=\"small\" type=\"danger\" @click=\"deleteUser(scope.row)\">删除</el-button>\r\n          </template>\r\n        </el-table-column>\r\n      </el-table>\r\n\r\n      <!-- 分页 -->\r\n      <div class=\"pagination\">\r\n        <el-pagination\r\n          v-model:current-page=\"currentPage\"\r\n          v-model:page-size=\"pageSize\"\r\n          :total=\"total\"\r\n          layout=\"total, sizes, prev, pager, next\"\r\n          :page-sizes=\"[10, 20, 50, 100]\"\r\n          @current-change=\"loadUsers\"\r\n          @size-change=\"handleSizeChange\"\r\n        />\r\n      </div>\r\n    </el-card>\r\n\r\n    <!-- 新增/编辑用户对话框 -->\r\n    <el-dialog v-model=\"showAddDialog\" title=\"用户信息\" width=\"500px\">\r\n      <el-form :model=\"userForm\" ref=\"userFormRef\" label-width=\"100px\">\r\n        <el-form-item label=\"用户名\">\r\n          <el-input v-model=\"userForm.username\" />\r\n        </el-form-item>\r\n        <el-form-item label=\"密码\" v-if=\"!editingUser\">\r\n          <el-input v-model=\"userForm.password\" type=\"password\" />\r\n        </el-form-item>\r\n        <el-form-item label=\"昵称\">\r\n          <el-input v-model=\"userForm.nickname\" />\r\n        </el-form-item>\r\n        <el-form-item label=\"手机号\">\r\n          <el-input v-model=\"userForm.phone\" />\r\n        </el-form-item>\r\n        <el-form-item label=\"邮箱\">\r\n          <el-input v-model=\"userForm.email\" type=\"email\" />\r\n        </el-form-item>\r\n        <el-form-item label=\"企业名称\">\r\n          <el-input v-model=\"userForm.companyName\" />\r\n        </el-form-item>\r\n        <el-form-item label=\"角色\">\r\n          <el-select v-model=\"userForm.role\" style=\"width: 100%\">\r\n            <el-option label=\"企业用户\" value=\"USER\" />\r\n            <el-option label=\"管理员\" value=\"ADMIN\" />\r\n          </el-select>\r\n        </el-form-item>\r\n        <el-form-item label=\"状态\">\r\n          <el-select v-model=\"userForm.status\" style=\"width: 100%\">\r\n            <el-option label=\"启用\" :value=\"1\" />\r\n            <el-option label=\"禁用\" :value=\"0\" />\r\n          </el-select>\r\n        </el-form-item>\r\n      </el-form>\r\n      <template #footer>\r\n        <el-button @click=\"showAddDialog = false\">取消</el-button>\r\n        <el-button type=\"primary\" @click=\"saveUser\">保存</el-button>\r\n      </template>\r\n    </el-dialog>\r\n\r\n    <!-- 查看用户对话框 -->\r\n    <el-dialog v-model=\"showViewDialog\" title=\"查看用户信息\" width=\"500px\">\r\n      <div v-if=\"viewingUser\">\r\n        <div class=\"view-item\">\r\n          <strong>头像：</strong><br/>\r\n          <el-avatar :size=\"80\" :src=\"getImageUrl(viewingUser.avatar)\" style=\"margin-top: 10px;\">\r\n            {{ viewingUser.nickname || viewingUser.username }}\r\n          </el-avatar>\r\n        </div>\r\n        <div class=\"view-item\">\r\n          <strong>用户名：</strong>{{ viewingUser.username }}\r\n        </div>\r\n        <div class=\"view-item\">\r\n          <strong>昵称：</strong>{{ viewingUser.nickname || '未设置' }}\r\n        </div>\r\n        <div class=\"view-item\">\r\n          <strong>手机号：</strong>{{ viewingUser.phone || '未设置' }}\r\n        </div>\r\n        <div class=\"view-item\">\r\n          <strong>邮箱：</strong>{{ viewingUser.email || '未设置' }}\r\n        </div>\r\n        <div class=\"view-item\">\r\n          <strong>企业名称：</strong>{{ viewingUser.companyName || '未设置' }}\r\n        </div>\r\n        <div class=\"view-item\">\r\n          <strong>角色：</strong>\r\n          <el-tag :type=\"viewingUser.role === 'ADMIN' ? 'danger' : 'primary'\">\r\n            {{ viewingUser.role === 'ADMIN' ? '管理员' : '企业用户' }}\r\n          </el-tag>\r\n        </div>\r\n        <div class=\"view-item\">\r\n          <strong>状态：</strong>\r\n          <el-tag :type=\"viewingUser.status === 1 ? 'success' : 'danger'\">\r\n            {{ viewingUser.status === 1 ? '启用' : '禁用' }}\r\n          </el-tag>\r\n        </div>\r\n        <div class=\"view-item\">\r\n          <strong>性别：</strong>{{ viewingUser.gender === 1 ? '男' : viewingUser.gender === 2 ? '女' : '未设置' }}\r\n        </div>\r\n        <div class=\"view-item\">\r\n          <strong>注册时间：</strong>{{ viewingUser.createTime }}\r\n        </div>\r\n      </div>\r\n      <template #footer>\r\n        <el-button @click=\"showViewDialog = false\">关闭</el-button>\r\n      </template>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, reactive, onMounted } from 'vue'\r\nimport { ElMessage, ElMessageBox } from 'element-plus'\r\nimport { Refresh } from '@element-plus/icons-vue'\r\nimport request from '../utils/request'\r\n\r\nconst users = ref([])\r\nconst loading = ref(false)\r\nconst showAddDialog = ref(false)\r\nconst showViewDialog = ref(false)\r\nconst editingUser = ref(null)\r\nconst viewingUser = ref(null)\r\nconst searchKeyword = ref('')\r\nconst currentPage = ref(1)\r\nconst pageSize = ref(10)\r\nconst total = ref(0)\r\nconst selectedUsers = ref([])\r\nconst roleFilter = ref('')\r\nconst statusFilter = ref('')\r\nconst dateRange = ref([])\r\n\r\nconst userForm = reactive({\r\n  username: '',\r\n  password: '',\r\n  nickname: '',\r\n  phone: '',\r\n  email: '',\r\n  companyName: '',\r\n  role: 'USER',\r\n  status: 1\r\n})\r\n\r\nconst userFormRef = ref()\r\n\r\nonMounted(() => {\r\n  loadUsers()\r\n})\r\n\r\nconst loadUsers = async () => {\r\n  loading.value = true\r\n  try {\r\n    const res = await request.get('/user/page', {\r\n      params: {\r\n        current: currentPage.value,\r\n        size: pageSize.value,\r\n        keyword: searchKeyword.value,\r\n        role: roleFilter.value,\r\n        status: statusFilter.value,\r\n        startDate: dateRange.value[0] ? dateRange.value[0].toISOString().split('T')[0] : null,\r\n        endDate: dateRange.value[1] ? dateRange.value[1].toISOString().split('T')[0] : null\r\n      }\r\n    })\r\n    users.value = res.data.records || []\r\n    total.value = res.data.total || 0\r\n  } catch (error) {\r\n    console.error('加载用户列表失败:', error)\r\n    users.value = []\r\n  } finally {\r\n    loading.value = false\r\n  }\r\n}\r\n\r\nconst viewUser = (user) => {\r\n  viewingUser.value = user\r\n  showViewDialog.value = true\r\n}\r\n\r\nconst editUser = (user) => {\r\n  editingUser.value = user\r\n  Object.assign(userForm, user)\r\n  showAddDialog.value = true\r\n}\r\n\r\nconst saveUser = async () => {\r\n  try {\r\n    if (editingUser.value) {\r\n      await request.put(`/user/${editingUser.value.id}`, userForm)\r\n      ElMessage.success('更新成功')\r\n    } else {\r\n      await request.post('/user', userForm)\r\n      ElMessage.success('创建成功')\r\n    }\r\n    showAddDialog.value = false\r\n    resetForm()\r\n    loadUsers()\r\n  } catch (error) {\r\n    console.error('保存用户失败:', error)\r\n  }\r\n}\r\n\r\nconst deleteUser = async (user) => {\r\n  try {\r\n    await ElMessageBox.confirm('确定要删除这个用户吗？', '提示')\r\n    await request.delete(`/user/${user.id}`)\r\n    ElMessage.success('删除成功')\r\n    loadUsers()\r\n  } catch (error) {\r\n    if (error !== 'cancel') {\r\n      console.error('删除用户失败:', error)\r\n    }\r\n  }\r\n}\r\n\r\nconst resetForm = () => {\r\n  editingUser.value = null\r\n  Object.assign(userForm, {\r\n    username: '',\r\n    password: '',\r\n    nickname: '',\r\n    phone: '',\r\n    email: '',\r\n    companyName: '',\r\n    role: 'USER',\r\n    status: 1\r\n  })\r\n}\r\n\r\nconst getImageUrl = (imagePath) => {\r\n  if (!imagePath) return ''\r\n  if (imagePath.startsWith('http')) return imagePath\r\n  return `http://localhost:8080/api${imagePath}`\r\n}\r\n\r\nconst exportUsers = async () => {\r\n  try {\r\n    const res = await request.get('/user/export', {\r\n      params: {\r\n        keyword: searchKeyword.value,\r\n        role: roleFilter.value,\r\n        status: statusFilter.value\r\n      },\r\n      responseType: 'blob'\r\n    })\r\n    \r\n    const blob = new Blob([res], { type: 'text/csv;charset=utf-8' })\r\n    const url = window.URL.createObjectURL(blob)\r\n    const a = document.createElement('a')\r\n    a.href = url\r\n    a.download = `users_${new Date().toISOString().split('T')[0]}.csv`\r\n    document.body.appendChild(a)\r\n    a.click()\r\n    document.body.removeChild(a)\r\n    window.URL.revokeObjectURL(url)\r\n    \r\n    ElMessage.success('导出成功')\r\n  } catch (error) {\r\n    console.error('导出失败:', error)\r\n    ElMessage.error('导出失败')\r\n  }\r\n}\r\n\r\nconst handleSizeChange = (size) => {\r\n  pageSize.value = size\r\n  currentPage.value = 1\r\n  loadUsers()\r\n}\r\n\r\nconst handleSelectionChange = (selection) => {\r\n  selectedUsers.value = selection.map(user => user.id)\r\n}\r\n\r\nconst batchDelete = async () => {\r\n  try {\r\n    await ElMessageBox.confirm('确定要删除选中的用户吗？', '提示')\r\n    await request.delete('/user/batch', {\r\n      data: {\r\n        ids: selectedUsers.value\r\n      }\r\n    })\r\n    ElMessage.success('删除成功')\r\n    loadUsers()\r\n  } catch (error) {\r\n    if (error !== 'cancel') {\r\n      console.error('批量删除失败:', error)\r\n    }\r\n  }\r\n}\r\n\r\nconst resetSearch = () => {\r\n  searchKeyword.value = ''\r\n  roleFilter.value = ''\r\n  statusFilter.value = ''\r\n  dateRange.value = []\r\n  loadUsers()\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.card-header {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n}\r\n\r\n.search-bar {\r\n  margin-bottom: 20px;\r\n}\r\n\r\n.pagination {\r\n  margin-top: 20px;\r\n  text-align: right;\r\n}\r\n\r\n.view-item {\r\n  margin-bottom: 15px;\r\n  line-height: 1.6;\r\n}\r\n\r\n.empty-data {\r\n  padding: 40px 0;\r\n}\r\n</style> "]}]}