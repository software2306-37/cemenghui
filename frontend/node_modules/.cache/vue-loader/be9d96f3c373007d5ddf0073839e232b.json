{"remainingRequest":"D:\\Program Files (x86)\\ys\\project\\springboot\\测盟汇系统\\frontend\\node_modules\\vue-loader-v16\\dist\\index.js??ref--1-1!D:\\Program Files (x86)\\ys\\project\\springboot\\测盟汇系统\\frontend\\src\\views\\Profile.vue?vue&type=style&index=0&id=f4607060&scoped=true&lang=css","dependencies":[{"path":"D:\\Program Files (x86)\\ys\\project\\springboot\\测盟汇系统\\frontend\\src\\views\\Profile.vue","mtime":1750536767101},{"path":"D:\\Program Files (x86)\\ys\\project\\springboot\\测盟汇系统\\frontend\\node_modules\\css-loader\\dist\\cjs.js","mtime":1750527325917},{"path":"D:\\Program Files (x86)\\ys\\project\\springboot\\测盟汇系统\\frontend\\node_modules\\vue-loader-v16\\dist\\stylePostLoader.js","mtime":1750527325076},{"path":"D:\\Program Files (x86)\\ys\\project\\springboot\\测盟汇系统\\frontend\\node_modules\\postcss-loader\\src\\index.js","mtime":1750527325628},{"path":"D:\\Program Files (x86)\\ys\\project\\springboot\\测盟汇系统\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1750527324930},{"path":"D:\\Program Files (x86)\\ys\\project\\springboot\\测盟汇系统\\frontend\\node_modules\\vue-loader-v16\\dist\\index.js","mtime":1750527325038}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQoudXNlci1pbmZvIHsNCiAgdGV4dC1hbGlnbjogY2VudGVyOw0KICBwYWRkaW5nOiAyMHB4Ow0KfQ0KDQoudXNlci1pbmZvIGgzIHsNCiAgbWFyZ2luOiAxNXB4IDAgNXB4IDA7DQogIGNvbG9yOiAjMzMzOw0KfQ0KDQoudXNlci1pbmZvIHAgew0KICBtYXJnaW46IDVweCAwOw0KICBjb2xvcjogIzY2NjsNCn0NCg0KLmF2YXRhci11cGxvYWRlciB7DQogIG1hcmdpbjogMTBweCAwOw0KfQ0K"},{"version":3,"sources":["D:\\Program Files (x86)\\ys\\project\\springboot\\测盟汇系统\\frontend\\src\\views\\Profile.vue"],"names":[],"mappings":";AA4OA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE;EACT,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;EAClB,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;AACf;;AAEA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE;EACZ,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,EAAE,CAAC;EACpB,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;AACb;;AAEA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,EAAE;EACX,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,CAAC;EACb,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC;AACb;;AAEA,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE;EACf,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,CAAC;AAChB","file":"D:/Program Files (x86)/ys/project/springboot/测盟汇系统/frontend/src/views/Profile.vue","sourceRoot":"","sourcesContent":["<template>\r\n  <div class=\"profile\">\r\n    <el-row :gutter=\"20\">\r\n      <el-col :span=\"8\">\r\n        <el-card>\r\n          <template #header>\r\n            <span>个人信息</span>\r\n          </template>\r\n          <div class=\"user-info\">\r\n            <el-avatar :size=\"80\" :src=\"getImageUrl(user.avatar)\">\r\n              {{ user.nickname || user.username }}\r\n            </el-avatar>\r\n            <el-upload\r\n              class=\"avatar-uploader\"\r\n              :action=\"uploadUrl\"\r\n              :show-file-list=\"false\"\r\n              :on-success=\"handleAvatarSuccess\"\r\n              :before-upload=\"beforeAvatarUpload\"\r\n            >\r\n              <el-button size=\"small\" type=\"text\">更换头像</el-button>\r\n            </el-upload>\r\n            <h3>{{ user.nickname || user.username }}</h3>\r\n            <p>{{ user.role === 'ADMIN' ? '超级管理员' : '企业用户' }}</p>\r\n            <p>{{ user.companyName }}</p>\r\n            <p>注册时间：{{ user.createTime }}</p>\r\n          </div>\r\n        </el-card>\r\n      </el-col>\r\n      \r\n      <el-col :span=\"16\">\r\n        <el-card>\r\n          <template #header>\r\n            <span>修改资料</span>\r\n          </template>\r\n          <el-form :model=\"profileForm\" ref=\"profileFormRef\" label-width=\"100px\">\r\n            <el-form-item label=\"用户名\">\r\n              <el-input v-model=\"profileForm.username\" disabled />\r\n            </el-form-item>\r\n            <el-form-item label=\"昵称\">\r\n              <el-input v-model=\"profileForm.nickname\" placeholder=\"请输入昵称\" />\r\n            </el-form-item>\r\n            <el-form-item label=\"手机号\">\r\n              <el-input v-model=\"profileForm.phone\" />\r\n            </el-form-item>\r\n            <el-form-item label=\"邮箱\">\r\n              <el-input v-model=\"profileForm.email\" />\r\n            </el-form-item>\r\n            <el-form-item label=\"性别\">\r\n              <el-select v-model=\"profileForm.gender\" style=\"width: 200px\">\r\n                <el-option label=\"未知\" :value=\"0\" />\r\n                <el-option label=\"男\" :value=\"1\" />\r\n                <el-option label=\"女\" :value=\"2\" />\r\n              </el-select>\r\n            </el-form-item>\r\n            <el-form-item label=\"企业名称\">\r\n              <el-input v-model=\"profileForm.companyName\" />\r\n            </el-form-item>\r\n            <el-form-item>\r\n              <el-button type=\"primary\" @click=\"updateProfile\" :loading=\"updating\">保存修改</el-button>\r\n            </el-form-item>\r\n          </el-form>\r\n        </el-card>\r\n\r\n        <el-card style=\"margin-top: 20px;\">\r\n          <template #header>\r\n            <span>修改密码</span>\r\n          </template>\r\n          <el-form :model=\"passwordForm\" ref=\"passwordFormRef\" label-width=\"100px\">\r\n            <el-form-item label=\"原密码\">\r\n              <el-input v-model=\"passwordForm.oldPassword\" type=\"password\" show-password />\r\n            </el-form-item>\r\n            <el-form-item label=\"新密码\">\r\n              <el-input v-model=\"passwordForm.newPassword\" type=\"password\" show-password />\r\n            </el-form-item>\r\n            <el-form-item label=\"确认密码\">\r\n              <el-input v-model=\"passwordForm.confirmPassword\" type=\"password\" show-password />\r\n            </el-form-item>\r\n            <el-form-item>\r\n              <el-button type=\"primary\" @click=\"changePassword\" :loading=\"changingPassword\">修改密码</el-button>\r\n            </el-form-item>\r\n          </el-form>\r\n        </el-card>\r\n      </el-col>\r\n    </el-row>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, reactive, onMounted } from 'vue'\r\nimport { ElMessage } from 'element-plus'\r\nimport request from '../utils/request'\r\n\r\nconst user = ref({})\r\nconst updating = ref(false)\r\nconst changingPassword = ref(false)\r\nconst uploadUrl = ref('/api/file/upload')\r\n\r\nconst profileForm = reactive({\r\n  username: '',\r\n  nickname: '',\r\n  phone: '',\r\n  email: '',\r\n  gender: 0,\r\n  companyName: ''\r\n})\r\n\r\nconst passwordForm = reactive({\r\n  oldPassword: '',\r\n  newPassword: '',\r\n  confirmPassword: ''\r\n})\r\n\r\nconst profileFormRef = ref()\r\nconst passwordFormRef = ref()\r\n\r\nonMounted(() => {\r\n  loadUserInfo()\r\n})\r\n\r\nconst loadUserInfo = async () => {\r\n  try {\r\n    // 优先从服务器获取最新用户信息\r\n    const userRes = await request.get('/user/current')\r\n    if (userRes.code === 200) {\r\n      user.value = userRes.data\r\n      localStorage.setItem('user', JSON.stringify(userRes.data))\r\n      Object.assign(profileForm, userRes.data)\r\n    }\r\n  } catch (error) {\r\n    // 如果服务器请求失败，则从本地存储获取\r\n    console.error('获取用户信息失败，使用本地缓存:', error)\r\n    const userStr = localStorage.getItem('user')\r\n    if (userStr) {\r\n      user.value = JSON.parse(userStr)\r\n      Object.assign(profileForm, user.value)\r\n    }\r\n  }\r\n}\r\n\r\nconst updateProfile = async () => {\r\n  updating.value = true\r\n  try {\r\n    await request.put('/user/profile', profileForm)\r\n    ElMessage.success('更新成功')\r\n    // 重新获取用户信息以确保数据同步\r\n    const userRes = await request.get('/user/current')\r\n    if (userRes.code === 200) {\r\n      user.value = userRes.data\r\n      localStorage.setItem('user', JSON.stringify(userRes.data))\r\n      Object.assign(profileForm, userRes.data)\r\n      // 触发全局事件通知其他组件更新用户信息\r\n      window.dispatchEvent(new CustomEvent('userUpdated', { detail: userRes.data }))\r\n    }\r\n  } catch (error) {\r\n    console.error('更新个人信息失败:', error)\r\n  } finally {\r\n    updating.value = false\r\n  }\r\n}\r\n\r\nconst changePassword = async () => {\r\n  if (passwordForm.newPassword !== passwordForm.confirmPassword) {\r\n    ElMessage.error('两次输入的密码不一致')\r\n    return\r\n  }\r\n  \r\n  if (passwordForm.newPassword.length < 6) {\r\n    ElMessage.error('密码长度不能少于6位')\r\n    return\r\n  }\r\n\r\n  changingPassword.value = true\r\n  try {\r\n    await request.post('/user/changePassword', {\r\n      oldPassword: passwordForm.oldPassword,\r\n      newPassword: passwordForm.newPassword\r\n    })\r\n    ElMessage.success('密码修改成功')\r\n    // 清空密码表单\r\n    Object.assign(passwordForm, {\r\n      oldPassword: '',\r\n      newPassword: '',\r\n      confirmPassword: ''\r\n    })\r\n  } catch (error) {\r\n    console.error('修改密码失败:', error)\r\n  } finally {\r\n    changingPassword.value = false\r\n  }\r\n}\r\n\r\nconst handleAvatarSuccess = async (response) => {\r\n  if (response.code === 200) {\r\n    // 更新头像\r\n    try {\r\n      await request.put('/user/profile', { avatar: response.data })\r\n      // 重新获取用户信息以确保数据同步\r\n      const userRes = await request.get('/user/current')\r\n      if (userRes.code === 200) {\r\n        user.value = userRes.data\r\n        localStorage.setItem('user', JSON.stringify(userRes.data))\r\n        // 触发全局事件通知其他组件更新用户信息\r\n        window.dispatchEvent(new CustomEvent('userUpdated', { detail: userRes.data }))\r\n      }\r\n      ElMessage.success('头像更新成功')\r\n    } catch (error) {\r\n      console.error('更新头像失败:', error)\r\n    }\r\n  } else {\r\n    ElMessage.error('头像上传失败')\r\n  }\r\n}\r\n\r\nconst beforeAvatarUpload = (file) => {\r\n  const isImage = file.type.indexOf('image/') === 0\r\n  const isLt2M = file.size / 1024 / 1024 < 2\r\n\r\n  if (!isImage) {\r\n    ElMessage.error('只能上传图片文件!')\r\n    return false\r\n  }\r\n  if (!isLt2M) {\r\n    ElMessage.error('图片大小不能超过 2MB!')\r\n    return false\r\n  }\r\n  return true\r\n}\r\n\r\nconst getImageUrl = (imagePath) => {\r\n  if (!imagePath) return ''\r\n  if (imagePath.startsWith('http')) return imagePath\r\n  return `http://localhost:8080/api${imagePath}`\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.user-info {\r\n  text-align: center;\r\n  padding: 20px;\r\n}\r\n\r\n.user-info h3 {\r\n  margin: 15px 0 5px 0;\r\n  color: #333;\r\n}\r\n\r\n.user-info p {\r\n  margin: 5px 0;\r\n  color: #666;\r\n}\r\n\r\n.avatar-uploader {\r\n  margin: 10px 0;\r\n}\r\n</style> "]}]}